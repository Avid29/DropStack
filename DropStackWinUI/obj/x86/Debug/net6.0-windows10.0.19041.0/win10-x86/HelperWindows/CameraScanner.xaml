<?xml version="1.0" encoding="utf-8"?>
<Window x:ConnectionId='1'
    x:Class="DropStackWinUI.HelperWindows.CameraScanner"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:DropStackWinUI.HelperWindows"
    xmlns:controls="using:CommunityToolkit.WinUI.Controls"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d">

    <Window.SystemBackdrop>
        <MicaBackdrop Kind="Base"/>
    </Window.SystemBackdrop>

    <Grid x:ConnectionId='2' x:Name="MainGrid">
        <Grid.RowDefinitions>
            <RowDefinition Height="30"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="15"/> <!-- spacing row-->
            <RowDefinition Height="170"/>
        </Grid.RowDefinitions>
        
        <!-- This handles the animations -->

        <Grid.Resources>
            <Storyboard x:ConnectionId='3' x:Name="FlashAnimation">
                <DoubleAnimation
                    Storyboard.TargetName="FlashRectangle"
                    Storyboard.TargetProperty="Opacity"
                    From="0.8"
                    To="0.0"
                    Duration="0:0:0.5">
                    <DoubleAnimation.EasingFunction>
                        <PowerEase EasingMode="EaseOut"/>
                    </DoubleAnimation.EasingFunction>
                </DoubleAnimation>
            </Storyboard>
            
            <Storyboard x:ConnectionId='4' x:Name="CameraFeedToGalleryAnimation"                                                   >
                <!-- opacity animation used to only stay visible during the animation -->
                <DoubleAnimation
                    Storyboard.TargetName="animationPreview"
                    Storyboard.TargetProperty="Opacity"
                    From="1.0" To="1.0" Duration="0:0:0.5"/>
                <DoubleAnimation x:ConnectionId='5'
                    Storyboard.TargetName="animationPreview"
                    Storyboard.TargetProperty="(UIElement.RenderTransform).(TransformGroup.Children)[0].(TranslateTransform.X)"
                    From="0"
                                                                                              
                    BeginTime="0:0:0"
                    Duration="0:0:0.45">
                    <DoubleAnimation.EasingFunction>
                        <PowerEase EasingMode="EaseInOut" />
                    </DoubleAnimation.EasingFunction>
                </DoubleAnimation>
                <DoubleAnimation x:ConnectionId='6'
                    Storyboard.TargetName="animationPreview"
                    Storyboard.TargetProperty="(UIElement.RenderTransform).(TransformGroup.Children)[0].(TranslateTransform.Y)"
                    From="0"
                                                                                              
                    Duration="0:0:0.5">
                    <DoubleAnimation.EasingFunction>
                        <PowerEase EasingMode="EaseInOut" />
                    </DoubleAnimation.EasingFunction>
                </DoubleAnimation>
                <DoubleAnimation x:ConnectionId='7'
                    Storyboard.TargetName="animationPreview"
                    Storyboard.TargetProperty="(UIElement.RenderTransform).(TransformGroup.Children)[1].(ScaleTransform.ScaleX)"
                    From="1"
                                                                                           
                    Duration="0:0:0.5">
                    <DoubleAnimation.EasingFunction>
                        <PowerEase EasingMode="EaseInOut" />
                    </DoubleAnimation.EasingFunction>
                </DoubleAnimation>
                <DoubleAnimation x:ConnectionId='8'
                    Storyboard.TargetName="animationPreview"
                    Storyboard.TargetProperty="(UIElement.RenderTransform).(TransformGroup.Children)[1].(ScaleTransform.ScaleY)"
                    From="1"
                                                                                           
                    Duration="0:0:0.5">
                    <DoubleAnimation.EasingFunction>
                        <PowerEase EasingMode="EaseInOut" />
                    </DoubleAnimation.EasingFunction>
                </DoubleAnimation>
                <DoubleAnimationUsingKeyFrames
                    Duration="0:0:0.5"
                    Storyboard.TargetName="animationPreview"
                    Storyboard.TargetProperty="(UIElement.RenderTransform).(TransformGroup.Children)[2].(RotateTransform.Angle)">
                    <EasingDoubleKeyFrame KeyTime="0:0:0" Value="0"/>
                    <EasingDoubleKeyFrame KeyTime="0:0:0.05" Value="0"/>
                    <EasingDoubleKeyFrame x:ConnectionId='9' KeyTime="0:0:0.2"                                                                       />
                    <EasingDoubleKeyFrame KeyTime="0:0:0.35" Value="0"/>
                    <EasingDoubleKeyFrame KeyTime="0:0:0.5" Value="0"/>
                </DoubleAnimationUsingKeyFrames>
            </Storyboard>
        </Grid.Resources>
        
        <!-- End of animation handling -->

        <Rectangle x:ConnectionId='10' x:Name="TitleBarRectangle" Grid.Row="0" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Opacity="0"/>

        <ScrollViewer x:ConnectionId='11' x:Name="GalleryScrollViewer" HorizontalScrollMode="Enabled" Grid.Row="3" VerticalScrollMode="Disabled" HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Hidden">
            <GridView x:ConnectionId='17'   
                    x:Name="GalleryGridView"
                    Height="150"
                    VerticalAlignment="Top"
                    Margin="15,0,15,0"
                    ScrollViewer.VerticalScrollMode="Disabled"
                    ScrollViewer.VerticalScrollBarVisibility="Hidden"
                    SelectionMode="Single"
                    AllowDrop="True"
                    CanReorderItems="True">
                <GridView.ItemContainerTransitions>
                    <TransitionCollection>
                        <EntranceThemeTransition  FromVerticalOffset="0" />
                    </TransitionCollection>
                </GridView.ItemContainerTransitions>
                <GridView.ItemTemplate>
                    <DataTemplate>
                        <Grid 
                            HorizontalAlignment="Center" 
                            VerticalAlignment="Top">
                            <Image 
                                x:Name="TargetImageDisplay" 
                                Source="{Binding DisplayedImage}" 
                                Opacity="{Binding GridOpacity}" 
                                Stretch="Uniform" 
                                Height="150" 
                                VerticalAlignment="Stretch" />
                        </Grid>
                    </DataTemplate>
                </GridView.ItemTemplate>
            </GridView>
        </ScrollViewer>

        <!-- This is deliberately placed at the bottom of the file despite it saying Grid.Row="1" for the correct Z sorting to occur.-->
        <Grid Grid.Row="1" HorizontalAlignment="Stretch" VerticalAlignment="Stretch">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <!-- Image Previewing Feed /-->
            <Grid Grid.Column="0" Background="Black" CornerRadius="4" Width="Auto" Margin="15,0,0,0">
                <Image x:ConnectionId='15' x:Name="imagePreview" Stretch="Uniform" VerticalAlignment="Stretch"/>
                <Rectangle x:ConnectionId='16' x:Name="FlashRectangle" Fill="White" Grid.Column="0" Opacity="0"/>
            </Grid>

            <!-- Image used to animate -->
            <Grid x:ConnectionId='12' x:Name="animationPreview" RenderTransformOrigin="0.5 ,1" Opacity="0" Grid.Column="0" CornerRadius="4">
                <Grid.RenderTransform>
                    <TransformGroup>
                        <TranslateTransform/>
                        <ScaleTransform/>
                        <RotateTransform/>
                    </TransformGroup>
                </Grid.RenderTransform>
                <Image x:ConnectionId='14' x:Name="animatedImage" Stretch="Uniform" VerticalAlignment="Stretch"/>
            </Grid>

            <StackPanel Grid.Column="1" Orientation="Vertical" VerticalAlignment="Center" HorizontalAlignment="Center" Spacing="10" Margin="15">
                <Button x:ConnectionId='13' x:Name="CapturePhotoButton" Height="70" Width="70" CornerRadius="35"                            Style="{StaticResource AccentButtonStyle}">
                    <FontIcon Glyph="&#xE722;" />
                </Button>
            </StackPanel>
        </Grid>
    </Grid>
</Window>

